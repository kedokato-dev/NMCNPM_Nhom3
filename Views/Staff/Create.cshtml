@model NMCNPM_Nhom3.Models.Entities.TblAccount
@{
	ViewData["Title"] = "Thêm tài khoản";
}

<div class="container">
	<div class="row">
		<div class="col-12">
			<h3 class="text-center mb-4">Thêm tài khoản</h3>

			@if (!ViewData.ModelState.IsValid)
			{
				<div class="alert alert-danger">
					@foreach (var modelError in ViewData.ModelState.Values.SelectMany(v => v.Errors))
					{
						<p>@modelError.ErrorMessage</p>
					}
				</div>
			}

			<form asp-action="Create" method="post" id="addStaffForm">
				<div class="mb-3">
					<label asp-for="SAccountName" class="form-label">Họ và tên</label>
					<input asp-for="SAccountName" class="form-control" required>
				</div>
				<div class="mb-3">
					<label asp-for="SPhoneNumber" class="form-label">Số điện thoại</label>
					<input asp-for="SPhoneNumber" class="form-control" required>
				</div>
				<div class="mb-3">
					<label asp-for="DDate" class="form-label">Ngày sinh</label>
					<input asp-for="DDate" type="date" class="form-control" required>
				</div>
				<div class="mb-3">
					<label asp-for="SPermissions" class="form-label">Loại tài khoản</label>
					<select asp-for="SPermissions" class="form-select" required>
						<option value="0">Quản lý</option>
						<option value="1">Nhân viên</option>
						<option value="2">Khách hàng</option>
					</select>
				</div>
				<div class="mb-3">
					<label asp-for="SUserIdentification" class="form-label">Số CCCD</label>
					<input asp-for="SUserIdentification" class="form-control" required>
				</div>
				<div class="mb-3">
					<label asp-for="SPassword" class="form-label">Mật khẩu</label>
					<input asp-for="SPassword" type="password" class="form-control" required>
				</div>

				<button type="submit" class="btn btn-primary" id="btn_add">Thêm</button>

			</form>
		</div>
	</div>
</div>

<div class="modal fade" id="messageModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Thông báo</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body" id="modalMessage"></div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
			</div>
		</div>
	</div>
</div>


<script>

	document.getElementById('btn_add').addEventListener('click', function () {
		var formData = new FormData(document.getElementById('addStaffForm'));
		fetch('/Staff/Create', {
			method: 'POST',
			body: formData
		})
		.then(response => response.json())
		.then(data => {
			document.getElementById('modalMessage').innerText = data.message;
			var modal = new bootstrap.Modal(document.getElementById('messageModal'));
			modal.show();

			if (data.redirectUrl) {
				// Đóng modal sau 2 giây và chuyển hướng
				setTimeout(function() {
					modal.hide();
					window.location.href = data.redirectUrl;
				}, 2000);
			}
		});
	});
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
